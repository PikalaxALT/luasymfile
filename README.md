# Lua Symfile Library

This library is intended for use with Gameboy, Super Gameboy, and Gameboy Color symfiles (extension: .sym) such as generated by [RGBDS](/rednex/rgbds) and read by [BGB](http://bgb.bircd.org/).  It is written with the [BizHawk emulator](/TASVideos/BizHawk) in mind.

## Installing

To install, simply download symfile.lua and add it to your project tree.

## Constants

This library contains constants corresponding to BizHawk memory domains.  They should only be referenced by these names:
> DOMAIN_ROM (0x0000 - 0x7FFF)\
> DOMAIN_VRAM (0x8000 - 0x9FFF)\
> DOMAIN_SRAM (0xA000 - 0xBFFF)\
> DOMAIN_WRAM (0xC000 - 0xDFFF)

## Auxiliary functions

This library contains two functions for converting between address formats.  The Gameboy system family uses banked memory in order to increase its capacity for addressible data and memory.  As such, addresses can be written either as an offset with respect to its domain, or as a bank:addr pair with respect to the system bus.

    uint gbaddr, uint domain = ba2gbaddr (bank, addr)

This function takes a bank, addr pair and returns its offset and domain constant.  If the addr lies outside one of the domains defined above, it returns an error.

    uint bank, uint addr = gbaddr2ba (gbaddr, domain)

This function takes an offset and a domain constant and returns the associated bank, addr pair.  If the domain is not defined above, the function returns an error.

## Core library methods

The library uses an object called `symfile`, which keeps track of loaded symbols in the table `symfile.symbols`.

    void symfile.clear (void)

Resets the symfile instance.  This is called whenever a new symfile is loaded, but is exposed in case you want to unload the symfile yourself.

    void symfile.read (str fname)

Resets the symfile instance and loads a new symfile from the provided file path.

    str name = symfile.get_name_from_ba (uint bank, uint addr)

Takes a (bank, addr) pair and finds the first symbol at that location.  If none is found, returns nil.

    str name = symfile.get_name_from_gbaddr (uint gbaddr, uint domain)

Takes an offset and domain and finds the first symbol at that location.  If none is found, returns nil.

    uint bank, uint addr symfile.get_ba_from_name (str name)

Takes a symbol name and returns its (bank, addr) pair.  If not found. returns nil, nil.

    uint gbaddr, uint domain symfile.get_gbaddr_from_name (str name)

Takes a symbol name and returns its offset and domain.  If not found. returns nil, nil.
